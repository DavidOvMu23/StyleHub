<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Este archivo define las vistas calendario, lista y formulario -->

    <!-- Vista de calendario para gestionar citas -->
    <record id="view_stylehub_cita_calendar" model="ir.ui.view">
        <field name="name">stylehub.cita.calendar</field>
        <field name="model">stylehub.cita</field>
        <field name="arch" type="xml">

            <!-- Evento de calendario para mostrar citas -->
            <!-- El calendario usa date_start/date_stop para hacer bloques de tiempo -->
            <calendar string="Citas" date_start="fecha_inicio" date_stop="fecha_fin" color="estilista_id" mode="week" quick_create="0" event_open_popup="true">
                <field name="cliente_id"/>
                <!-- Widget monetary: formateamos el importe con la moneda de la empresa (me daba error al hacerlo de otra forma y el chat me lo recomendó así, el monetary sirve para formatear la moneda con la configuración de la comañia así también se mejora la presentación) -->
                <field name="importe_total" widget="monetary"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <!-- Vista de lista -->
    <!-- Lista para consultar citas con por estado -->
    <record id="view_stylehub_cita_list" model="ir.ui.view">
        <field name="name">stylehub.cita.list</field>
        <field name="model">stylehub.cita</field>
        <field name="arch" type="xml">

            <!-- Lista para mostrar varias citas -->
            <list decoration-info="state == 'borrador'" decoration-success="state == 'confirmada'" decoration-muted="state == 'cancelada'">
                <field name="fecha_inicio"/>
                <field name="cliente_id"/>
                <field name="estilista_id"/>
                <field name="importe_total" sum="Total Ventas"/>
                <!-- Widget badge: muestra el estado con una etiqueta -->
                <field name="state" widget="badge" decoration-success="state == 'realizada'" decoration-info="state == 'confirmada'"/>
            </list>
        </field>
    </record>

    <!-- Vista de formulario para crear/editar una cita -->
    <!-- Formulario principal con botones de flujo de trabajo -->
    <record id="view_stylehub_cita_form" model="ir.ui.view">
        <field name="name">stylehub.cita.form</field>
        <field name="model">stylehub.cita</field>
        <field name="arch" type="xml">     
            <form>
                <header>
                    <!-- Botones según el estado de la cita -->
                    <button name="action_confirmar" string="Confirmar Cita" type="object" class="oe_highlight" invisible="state != 'borrador'"/>
                    <button name="action_realizar" string="Finalizar Trabajo" type="object" class="oe_highlight" invisible="state != 'confirmada'"/>
                    <button name="action_cancelar" string="Cancelar" type="object" invisible="state in ('realizada', 'cancelada')"/>
                    
                    <!-- Widget statusbar: representa el flujo de estados de la cita -->
                    <field name="state" widget="statusbar" statusbar_visible="borrador,confirmada,realizada"/>
                </header>

                <sheet>
                    <!-- Título: muestra el cliente principal de la cita -->
                    <div class="oe_title">
                        <h1>
                            <field name="cliente_id" placeholder="Selecciona Cliente..."/>
                        </h1>
                    </div>

                    <group>
                        <group>
                            <!-- Selección de estilista responsable -->
                            <field name="estilista_id"/>
                        </group>
                        <group>
                            <!-- Fecha y hora de inicio y fin de la cita -->
                            <field name="fecha_inicio"/>
                            <field name="fecha_fin" readonly="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Servicios">
                            <!-- Líneas de servicios relacionados con la cita -->
                            <field name="lineas_ids">
                                <list editable="bottom">
                                    <field name="servicio_id"/>
                                    <field name="duracion" sum="Total Horas"/>
                                    <field name="precio" sum="Total Precio"/>
                                </list>
                            </field>

                            <!-- Subtotal / total de la cita, alineado a la derecha -->
                            <group class="oe_subtotal_footer oe_right">
                                <!-- Widget monetary: asegura formato de moneda en el total -->
                                <field name="importe_total" widget="monetary" decoration-bf="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Vista kanban para una representación visual de las citas -->
    <!-- Kanban: tarjetas agrupadas por estado -->
    <record id="view_stylehub_cita_kanban" model="ir.ui.view">
        <field name="name">stylehub.cita.kanban</field>
        <field name="model">stylehub.cita</field>
        <field name="arch" type="xml">
            <!-- Kanban para mostrar citas agrupadas por estado -->
            <kanban default_group_by="state" records_draggable="false">
                <field name="state"/>
                <field name="id"/>
                <field name="cliente_id"/>
                <field name="estilista_id"/>
                <field name="importe_total"/>
                
                <templates>
                    <t t-name="card">
                        <div t-attf-class="oe_kanban_global_click">
                            
                            <div class="o_kanban_record_top mb-2">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="cliente_id"/>
                                    </strong>
                                </div>
                                <div class="o_kanban_record_top_right">
                                    <!-- Widget monetary: muestra el importe con formato monetario -->
                                    <strong><field name="importe_total" widget="monetary"/></strong>
                                </div>
                            </div>

                            <div class="o_kanban_record_body">
                                <span class="text-muted">Estilista: </span>
                                <field name="estilista_id"/>
                            </div>
                            
                            <div class="o_kanban_record_bottom mt-2">
                                <div class="oe_kanban_bottom_left">
                                    <field name="fecha_inicio"/>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <!-- Widget label_selection: etiqueta el estado con estilos por clase -->
                                    <field name="state" widget="label_selection" 
                                           options="{'classes': {'borrador': 'default', 'confirmada': 'info', 'realizada': 'success', 'cancelada': 'danger'}}"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Acción que abre la agenda -->
    <!-- Acción de ventana para el modelo de citas -->
    <record id="action_stylehub_cita" model="ir.actions.act_window">
        <field name="name">Agenda de Citas</field>
        <field name="res_model">stylehub.cita</field>
        <field name="view_mode">calendar,kanban,list,form</field>
    </record>
    
    <!-- Menú para acceder a la agenda de citas -->
    <menuitem id="menu_stylehub_cita" name="Agenda" parent="menu_stylehub_root" action="action_stylehub_cita" sequence="5"/>

</odoo>